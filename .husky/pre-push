#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

# Run full test suite with coverage
echo "ğŸ§ª Running full test suite..."
pnpm test:coverage || {
  echo "âŒ Tests failed"
  exit 1
}

# Build check
echo "ğŸ—ï¸  Building project..."
pnpm build || {
  echo "âŒ Build failed"
  exit 1
}

# Security audit
echo "ğŸ”’ Running security audit..."
pnpm audit --audit-level=high || {
  echo "âš ï¸  Security vulnerabilities found - review before pushing"
  read -p "Continue anyway? (y/N) " -n 1 -r
  echo
  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    exit 1
  fi
}

echo "âœ… Pre-push checks passed!"
