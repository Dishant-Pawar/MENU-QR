#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Type check
echo "ğŸ“ Type checking..."
pnpm tsc --noEmit || {
  echo "âŒ Type check failed"
  exit 1
}

# Run tests
echo "ğŸ§ª Running tests..."
pnpm test:run || {
  echo "âŒ Tests failed"
  exit 1
}

# Security check - look for common issues
echo "ğŸ”’ Security check..."
if grep -r "console.log" src/ --exclude-dir=__tests__ > /dev/null 2>&1; then
  echo "âš ï¸  Warning: console.log statements found in src/"
fi

if grep -rE "(password|secret|api_key|token).*=.*['\"][^'\"]{8,}" src/ --exclude-dir=__tests__ > /dev/null 2>&1; then
  echo "âŒ Potential hardcoded secrets detected!"
  exit 1
fi

echo "âœ… Pre-commit checks passed!"
